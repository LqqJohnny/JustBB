<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>聊天室</title>
<script type="text/javascript" src="/javascripts/jquery.min.js"></script>
<script type="text/javascript" src="/javascripts/jquery.cookie.js"></script>
<link type="text/css" rel="stylesheet" href="/stylesheets/common.css">
<link type="text/css" rel="stylesheet" href="/stylesheets/chat.css">
</head>
<body>
  <div id="contain">
    <div id="content">
      <div id="content_show">
        <div id="contents"></div>
      </div>
      <div id="content_saying">
        <div id="toolbar"></div>
        <div id="input_content" contenteditable="true"></div>
        <div id="sayingto">你好 <span id="from"></span> ，你正在对 <span id="to"></span> 说</div>
        <div id="say">发送</div>
      </div>
    </div>
    <div id="users_online">
        <div class="currentUser">
            <div id="icon"></div>
            <div id="username"></div>
        </div>
      <div id="usersbar">
        <div id="user_label">在线用户</div>
        <div id="users_list">
          <ul id="list"></ul>
        </div>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script type="text/javascript" src="/javascripts/chat.js"></script>
  <script type="text/javascript">

    $("#icon").html(from.substring(0,1));
    $("#username").html(from);

    //发话
    $("#say").click(function() {
      //获取要发送的信息
      var $msg = $("#input_content").text().replace(/[\r\n]/g,"");
      if ($msg == "") return;
      //把发送的信息先添加到自己的浏览器 DOM 中
      if (to == "all") {
        $("#contents").append('<div class="right"><div class="time">'+now()+'</div><div class="msg">' + $msg + '</div><div class="icon">'+from.substring(0,1)+'</div></div><br />');
      } else {
        $("#contents").append('<div  class="right secret" ><div class="time">'+now()+'</div><div class="tag">私</div><div class="msg">' + $msg + '</div><div class="icon">'+from.substring(0,1)+'</div></div><br />');
      }
      //发送发话信息
      socket.emit('say', {from: from, to: to, msg: $msg});
      //清空输入框并获得焦点
      $("#input_content").html("").focus();
      scroll();
    });
    $("#input_content").keydown(function(event) {
        /* Act on the event */
        if(event.keyCode==13){
            $("#say").click();
        }
    });

  </script>
</body>
</html>
